[{"title":"配置Github的SSH key","url":"/2024/02/19/配置Github的SSH-key/","content":"\n**SSH** (Secure Shell，安全外壳协议) 可以连接远程服务器和服务并向它们验证。利用 SSH 密钥可以连接到 GitHub，而无需在每次访问时都提供用户名和 personal access token。还可以使用 SSH 密钥对提交进行签名。\n\n### 配置步骤：\n\n1. 确保本地电脑已经安装[Git](https://git-scm.com/download/win)。\n\n2. 检查SSH keys。(需要寻找一对以 id_dsa 或 id_rsa 命名的文件，其中一个带有 .pub 扩展名。 .pub 文件是公钥)\n\n   ```\n   // 运行Git Bash 然后输入\n   ls -al ~/.ssh\n   \n   // 如果没有类似以下输出结果，则需要进入下一步生成SSH Key\n   // -rw-r--r-- 1 UserName 197121 2610 Feb 18 11:28 id_rsa\n   // -rw-r--r-- 1 UserName 197121  575 Feb 18 11:28 id_rsa.pub\n   ```\n\n3. 如果本地不存在SSH Key，需要[生成SSH Key](https://docs.github.com/zh/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent)。\n\n   ```\n   // 运行Git Bash 然后输入生成指令\n   ssh-keygen -t rsa -C \"jxzhangms@hotmail.com\"\n   // 最后一项参数为GitHub的邮件地址，这将以提供的电子邮件为标签创建新的SSH Key\n   \n   // 提示输入保存地址时，使用默认位置（直接按回车），提示如下：\n   // Enter file in which to save the key (/Users/you/.ssh/id_rsa):[直接输入回车]\n   \n   // 提示输入密码（可以直接按回车跳过），如下：\n   // Enter passphrase (empty for no passphrase): [Type a passphrase]\n   // Enter same passphrase again: [Type passphrase again]\n   ```\n\n4. [将 SSH 密钥添加至 GitHub 帐户](https://docs.github.com/zh/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account)\n\n   1. 复制SSH密钥数据：\n\n      密钥文件路径（默认）为 \"%UserProfile%/.ssh/id_rsa.pub\"，可以通过指令将SSH密钥添加到剪贴板。\n\n      ```\n      // 运行Git Bash 然后输入\n      clip < ~/.ssh/id_rsa.pub\n      // 如果剪切板没有数据，检查SSH密钥的文件路径是否有效\n      ```\n\n   2. 单击Github页面右上角的个人头像，找到 \"Setting\"。\n\n   3. 在左边栏的“Access”中，选择“SSH and GPG keys”。\n\n   4. 点击“New SSH 密钥” ：\n\n      1. 在 \"Title\"字段中，为新密钥添加描述性标签（可随意填写）。\n      2. 在 \"Key Type\" 中选择\"Authentication Key\"（默认选项）。\n      3. 在“密钥”字段中，粘贴公钥，点击“Add SSH Key”。\n\n   \n\n   \n\n","tags":["Github","Hexo"]},{"title":"Hexo源文件的备份与更新","url":"/2024/02/19/Hexo源文件的备份与更新/","content":"\n## 一 备份本地Hexo源文件\n\n1. 确保当前Hexo源文件为最新版本（与Github上比较）\n\n2. 清除过程文件\n\n   1. 删除Hexo源文件里的 ”.deploy_git”文件夹\n   2. 删除过程文件（hexo clean）\n\n3. 备份Hexo源文件到Github\n\n   注意：如果使用git克隆过主题，需要显示隐藏文件并把主题文件中的.git文件夹删掉（git不能嵌套上传）。\n\n   ```\n   // 进入hexo文件夹，在命令行执行以下操作：\n   \n   git init\t// git初始化\n   \n   //关联github仓库\n   git remote add origin https://github.com/motylcc/HexoBlog.git\t\n   \t// 如果出现错误“fatal: remote origin already exists”，执行以下：\n   \t// git remote rm origin\n   \t// 重新执行 git remote add origin \n   \t\n   git add .\t//添加当前文件夹下的所有文件\n   git commit -m \"Update Backup\"\t//引号中的内容为对该文件的描述\n   git push origin master\t//上传\n   ```\n\n## 二 异地更新博客\n\n1. 确保当前计算机已经安装[Git](https://git-scm.com/download/win)和[Node.js](https://nodejs.org/en/) （新版的Node.js已经集成了npm）。\n\n   ```\n   // 查看所需软件的版本信息\n   git -v\n   node -v\n   npm -v\n   ```\n\n2. 配置ssh-key。\n\n3. 配置全局用户名和邮箱：\n\n   用户在GitHub中提交修改时会记录用户名和邮箱，Github通过本地配置的邮箱地址和用户名统计GitHub账户的贡献度（小绿块）。\n\n   ```\n   // 查看当前的Git配置信息\n   git config --list   // 查看git配置信息\n   git config user.name   // 查看用户名\n   git config user.email   // 查看邮箱\n   \n   // 配置全局用户名和邮箱\n   git config --global user.name \"motylcc\"   // 设置全局用户名（github用户名）\n   git config --global user.email  \"jxzhangms@hotmail.com\"   // 设置全局邮箱（github注册邮箱）\n   ```\n\n4. 确保当前计算机已经安装安装Hexo。\n\n   ```\n   hexo -v   // 查看本地是否已经安装Hexo\n   npm install -g hexo   // Hexo安装指定\n   \n   // 安装其他组件\n   npm install --save hexo-deployer-git   // 为了使用hexo d来部署到git上 \n   npm install hexo-generator-feed --save   // 为了建立RSS订阅\n   npm install hexo-generator-sitemap --save   // 为了建立站点地图\n   ```\n\n5. 拉取Github上的hexo源文件（确保最新版本）：\n\n   1. 新建一个文件夹，通过Git拉取hexo源文件。\n\n   2. 进入新建的文件夹，命令行执行以下操作：\n\n      ```\n      git init\n      git remote add origin https://github.com/motylcc/HexoBlogSrc.git\n      git fetch --all\n      git reset --hard origin/master\n      ```\n\n6. 编写新的文章（hexo new）。\n\n7. 推送新文章（hexo deploy）。\n\n8. 备份新的Hexo源文件到Github：\n\n   1. 进入当前的hexo文件夹，删除”.deploy_git”文件夹\n\n   2. 命令行执行：\n\n      ```\n      hexo clean\n      git add .\t//添加当前文件夹下的所有文件\n      git commit -m \"Update Backup\"\t//引号中的内容为对该文件的描述\n      git push origin master\t//上传\n      ```\n\n      \n\n\n\n","tags":["Github","Hexo"]},{"title":"FluidFlux","url":"/2023/03/22/FluidFlux/","content":"\n# M_FluxSurfaceOver\n\n<center>\n    <img src=\"M_FluxSurfaceOver.png\" width=\"100%\"> \n    <div> M_FluxSurfaceOver </div>\n</center>\n\n## MF_SurfaceLayer\n\n<center>\n    <img src=\"MF_SurfaceLayer.png\" width=\"100%\"> \n    <div> MF_SurfaceLayer </div>\n</center>\n\n输出材质属性和透明度（Opacity Mask）\n\n### MF_SurfaceFlux_Mesh\n\n<center>\n    <img src=\"MF_SurfaceFlux_Mesh.png\" width=\"100%\"> \n    <div> MF_SurfaceFlux_Mesh </div>\n</center>\n\n读取顶点和UV数据，设置材质属性\n\n* R+G：Flow (Velocity)    \n* Alpha：Foam Mask\n\n#### MF_SurfaceFluxSet\n\n<center>\n    <img src=\"MF_SurfaceFluxSet.png\" width=\"100%\"> \n    <div> MF_SurfaceFluxSet </div>\n</center>\n\n#### MF_SurfaceFluxGet\n\n<center>\n    <img src=\"MF_SurfaceFluxGet.png\" width=\"100%\"> \n    <div> MF_SurfaceFluxGet </div>\n</center>\n\n### MF_WaterlineCorrection\n\n<center>\n    <img src=\"MF_WaterlineCorrection.png\" width=\"100%\"> \n    <div> MF_WaterlineCorrection </div>\n</center>\n\n修改WPO：将与相机的距离做为Mask，乘以WPO  \n效果：当相机靠近水面时，WPO效果减弱\n\n### MF_SurfaceFluxInteraction\n\n<center>\n    <img src=\"MF_SurfaceFluxInteraction.png\" width=\"100%\"> \n    <div> MF_SurfaceFluxInteraction </div>\n</center>\n\n通过采样一张贴图（法线+高度）叠加到输入的法线和速度方向  \n\n\n* 修改Flow (Velocity) ：加上**MF_FluxDetailInteraction**输出的法线（N * 0.1)   \n* 修改Normal：加上***MF_FluxDetailInteraction**输出的法线（N.z = 0)  \n  **MF_FluxDetailInteraction**默认输出的N = (0.5, 0.5, 0.5)\n\n#### MF_FluxDetailInteraction\n\n<center>\n    <img src=\"MF_FluxDetailInteraction.png\" width=\"100%\"> \n    <div> MF_FluxDetailInteraction </div>\n</center>\n\n输入：World Position (R, G)  ，贴图（InteractionNormalHeight）\n输出：  \n\n* UV：WorldPosition * 0.01  (未启用)\n\n* 法线：Tex.RG\n\n* Height：Tex.B\n\n* Foam：Tex.A\n\n  贴图默认为4x4，RGB为灰色，A为1（在材质实例中使用该默认贴图)\n\n##### MF_FluxWorldToInteractionUV\n\n<center>\n    <img src=\"MF_FluxWorldToInteractionUV.png\" width=\"100%\"> \n    <div> MF_FluxWorldToInteractionUV </div>\n</center>\n\n输入：World Position (R, G)  \n输出：\n\n* UV Position (V2)：WorldPosition * 0.01\n* UV Size (S) ：未启用\n\n###### MF_FluxInteractionUV\n\n<center>\n    <img src=\"MF_FluxInteractionUV.png\" width=\"100%\"> \n    <div> MF_FluxInteractionUV </div>\n</center>\n\n输出：  \n\n* Location (V2)：(0.0, 0.0)（default）\n* Scale (S)：100（default）\n* ScaleInv(S)：0.01（default）\n\n### MF_SurfaceWind\n\n<center>\n    <img src=\"MF_SurfaceWind.png\" width=\"100%\"> \n    <div> MF_SurfaceWind </div>\n</center>\n\n根据输入的风向更新Flow\n\n### MF_SurfaceFlux_State\n\n<center>\n    <img src=\"MF_SurfaceFlux_State.png\" width=\"100%\"> \n    <div> MF_SurfaceFlux_State </div>\n</center>\n\n有三个输出（Mask, SurfaceLayer, UV），主要关注Mask （Opacity Mask）  \n\n\n#### MF_FluxWorldToSimulationUV\n\n<center>\n    <img src=\"MF_FluxWorldToSimulationUV.png\" width=\"100%\"> \n    <div> MF_FluxWorldToSimulationUV </div>\n</center>\n\n输出UV和Offset (未启用)\n\nUV = (WorldPosition - (1, 0)) / (0, 0) ???  \n*MF_FluxSimulationUV的参数WorldToSimulationUV可能是流体模拟时传入*？\n\n##### MF_FluxSimulationUV\n\n<center>\n    <img src=\"MF_FluxSimulationUV.png\" width=\"100%\"> \n    <div> MF_FluxSimulationUV </div>\n</center>\n\n输出：\n\n* Scale (V2)：默认值为 (0, 0)\n* Location (V2)：默认值为 (1, 0)\n* Height (S) ：默认值为 0.0\n* Resolution (V2)：（未启用）\n* TexelSize (V2)： 默认值 (1, 0)\n\n##### MF_FluxVelocity\n\n<center>\n    <img src=\"MF_FluxVelocity.png\" width=\"100%\"> \n    <div> MF_FluxVelocity </div>\n</center>\n\n主要关注Mask输出（默认由多个MF_FluxSample输出的volume值取最大值，UseExtraMasking参数为False时，Mask值等于一个不加偏移值的MF_FluxSample输出的volume）\n\n###### MF_FluxSample\n\n<center>\n    <img src=\"MF_FluxSample.png\" width=\"100%\"> \n    <div> MF_FluxSample </div>\n</center>\n\n主要关注Volume输出（FluidVelocityHeightFoam贴图的蓝色通道）\n\n## MF_FluidDetailWave\n\n<center>\n    <img src=\"MF_FluidDetailWave.png\" width=\"100%\"> \n    <div> MF_FluidDetailWave </div>\n</center>\n\n更新法线和Scattering (Roughness)  \n增加法线细节（Tex：DetailWaveNormal）\n\nMF_FluidDetailWaveSample\n\n<center>\n    <img src=\"MF_FluidDetailWaveSample.png\" width=\"100%\"> \n    <div> MF_FluidDetailWaveSample </div>\n</center>\n\n采样一张细节法线贴图（Tex：DetailWaveNormal），输出法线数据\n"},{"title":"使用WorldCreator更新UE地形","url":"/2023/02/07/使用WorldCreator更新UE地形/","content":"\nUE的地形可以通过导出高度图进WorldCreator制作地貌细节，完成后再从WorldCreator输出高度图给UE更新地形。\n\n<!--More-->\n\n## 存在的问题\n\n### 尺寸规范问题\n\n#### 地形大小不同\n\n**WorldCreator的地形尺寸是2的n次幂（512, 1024, 2048 ... ），而UE的地形尺寸一般为奇数**（[参考官方文档的地形尺寸建议](https://docs.unrealengine.com/5.1/zh-CN/landscape-technical-guide-in-unreal-engine/)）。\n\n<center>\n    <img src=\"UELandscapeInfo.png\" width=\"40%\"> \n    <div style=\"padding: 15px;\"> UE Landscape Info </div>\n    <br>\n</center>\n以上图的UE地形为例，对于1017x1017的尺寸，WorldCreator只能输出1024x1024的高度图。在UE使用1024x1024高度图更新1017x1017的地形会导致边缘高度丢失（迭代多次后，边缘高度信息将大量丢失）\n\n<center>\n    <img src=\"edgeCrop.png\" width=\"70%\"> \n    <div style=\"padding: 15px;\"> 地形边缘高度丢失 </div>\n    <br>\n</center>\n#### WorldCreator不支持长宽不等的地形\n\n在WorldCreator中，地形的长宽尺寸是一致的。如果输入的高度图是一个长方形的地形，会被压缩成正方形，导致地形比例失真。\n\n<center>\n    <img src=\"WC_RemapTerrainSize.png\" width=\"80%\"> \n    <div style=\"padding: 15px;\"> 长宽不等的地形在WorldCreator中被压缩成正方形 </div>\n    <br>\n</center>\n\n#### 尺寸匹配的解决方案\n\n**UE输出高度图时匹配WorldCreator的地形尺寸**。   \n\n1. 根据WorldCreator高度图的裁剪方式（以左上角为枢轴点，裁剪右下方的区域），将UE的地形扩展至2的n次幂（延X轴和Y轴的正方向），匹配WorldCreator的地形尺寸\n\n1. 在WorldCreator处理完地形后，导出高度图时将其裁剪为UE地形的尺寸。\n\n<center>\n    <img src=\"WC_HeightmapCrop.png\" width=\"50%\"> \n    <div style=\"padding: 15px;\"> WorldCreator高度图裁剪 </div>\n    <br>\n</center>\n\n<center>\n    <img src=\"SizeResize.png\" width=\"99%\"> \n    <div style=\"padding: 15px;\"> 地形扩展与裁剪 </div>\n    <br>\n</center>\n\n\n### 高度缩放问题\n\n<center>\n    <img src=\"Heightmap01.png\" width=\"40%\"> \n    <div style=\"padding: 15px;\"> Heightmap （16bit, Single Channel） </div>\n    <br>\n</center>\n#### 高度比例不同\n\n对于一张16位的灰度图（在默认缩放值下），UE地形的高度范围是-256米到256米，可以描述高度差在512米以内的地形。WorldCreator的地形范围是-106到10。6米。因此，在默认设置下，WorldCreator不能通过高度图准确地还原UE地形。\n\n<center>\n    <img src=\"HeightRangeDifference.png\" width=\"95%\"> \n    <div style=\"padding: 15px;\"> Height Range Difference </div>\n    <br>\n</center>\n<center>\n    <img src=\"HeightErrorInUE.png\" width=\"95%\"> \n    <div style=\"padding: 15px;\"> 默认高度比例下UE和World Creator地形高度比较 </div>\n    <br>\n</center>\n\n\n#### 视口显示比例不一致\n\nUE在视口中的地形与其尺寸是成正比的，而WorldCreator无法在视口中设置地块的尺寸，只能通过地形精度（Precision）修改输出的高度图尺寸。对于灰度范围相同但尺寸不同的高度图， WC生成的地形是一样的。\n\n<center>\n    <img src=\"ViewPortUE_1K_4k_1.gif\" width=\"90%\"> \n    <div style=\"padding: 15px;\"> UE Viewport (1k ~ 4k) </div>\n    <br>\n</center>\n\n<center>\n    <img src=\"ViewPortWC_4K_1K.gif\" width=\"90%\"> \n    <div style=\"padding: 15px;\"> WorldCreator Viewport (1k ~ 4k) </div>\n    <br>\n</center>\n\n视口比例不一致导致在正确的高度缩放值下，WorldCreator所呈现的地形高度被压缩或拉伸，如下图所示：\n\n<center>\n    <img src=\"WC_DifferentSizeinViewport.png\" width=\"75%\"> \n    <div style=\"padding: 15px;\"> 地形尺寸对WorldCreator视口高度的影响 </div>\n    <br>\n</center>\n\n#### 高度缩放问题的解决方案  \n\n1. 在WorldCreator导入高度图时，根据下面公式修改高度缩放值（Height Scale）还原UE地形的高度比例。\n   $$\n   HeightScale = 256 / 106 * (1024 / Size) \\tag{1} \\label{eq1}\n   $$\n\t表1 WorldCreator不同地形尺寸的高度缩放值\n   \n   | Landscape Size | Height Scale |\n   | :------------: | :----------: |\n   |  8192 x 8192   |    0.3019    |\n   |  4096 x 4096   |    0.6038    |\n   |  2048 x 2048   |    1.2075    |\n   |  1024 x 1024   |    2.4151    |\n   |   512 x 512    |    4.8302    |\n   |   256 x 256    |    9.6604    |\n   <center>\n       <img src=\"HeightScaleMismatch.png\" width=\"99%\"> \n       <div style=\"padding: 15px;\"> 高度缩放匹配地形尺寸 </div>\n       <br>\n   </center>\n   \n2. WorldCreator编辑完成后，还原正确的高度缩放值（将高度缩放值修改为2.4151）\n\n3. 在WorldCreator导出高度图时，开启自动归一化选项，将地形高度映射为0~255的灰度范围。\n\n   <center>\n       <img src=\"WC_AutoNormalizeHeightmap.png\" width=\"50%\"> \n       <div style=\"padding: 15px;\"> WorldCreator高度图归一化设置 </div>\n       <br>\n   </center>\n\n6. 在UE导入高度图时，根据WorldCreator的地形高度范围设置Landscape的高度缩放和偏移值。\n\n   <center>\n       <img src=\"WC_GPUInfo.png\" width=\"50%\"> \n       <div style=\"padding: 15px;\"> WorldCreator高度范围 </div>\n       <br>\n   </center>\n   高度缩放和偏移的计算公式如下：\n   \n   $$\n   \\begin{align}\n   ScaleZ =& (MaxHeight-MinHeight) * 100 / 512 \\tag{2} \\label{eq2}\\\\\n   offsetZ =& ((MaxHeight-MinHeight)/2 + MinHeight) * 100 \\tag{3} \\label{eq3}\n   \\end{align}\n   $$\n\n\n\n## 流程细节\n\n由于UE和WorldCreator的地形存在上述问题，在导入和导出高度图的过程中需要计算地形在不同平台的高度缩放值和偏移值。这些计算可以通过Houdini Engine读取UE地形在后台完成并将结果显示在HDA（heightmap_worldcreator_yh_SOP）的参数面板中，如下图所示：\n\n<center>\n    <img src=\"HDAParameters.png\" width=\"60%\"> \n    <div style=\"padding: 15px;\"> HDA参数面板 </div>\n    <br>\n</center>\n* Min Height / Max Height：地形的高度范围\n* UE Landscape\n  * Offset Z：UE地形的高度偏移值\n  * Scale Z：UE地形的高度缩放值\n  * Heighmap File：UE高度图的输出路径\n  * Save Heightmap：输出UE高度图\n* World Creator Terrain\n  * Height Scale：WorldCreator 的高度缩放值\n  * Precision (Meter)：World Creator 的地形精度\n\n### UE导出高度图\n\n  1. 将HDA（heightmap_worldcreator_yh_SOP）拖入场景中，将Transform数据需要归零。\n\n     <center>\n         <img src=\"HDATransform.png\" width=\"70%\"> \n         <div style=\"padding: 15px;\"> HDA Transform </div>\n         <br>\n     </center>\n\n  2. 设置HDA的输入类型（Landscape Input）并选择目标地形（不能选择地形分块）。\n\n     <center>\n         <img src=\"HDAInput.png\" width=\"50%\"> \n         <div style=\"padding: 15px;\"> HDA输入 </div>\n         <br>\n     </center>\n\n  3. 点击HDA参数面板的**Read Landscape**获取地形数据。\n\n4. 设置HDA参数面板的高度图输出路径**Heightmap File**，然后点击**Save Heightmap**输出高度图。\n\n   **注意**：HDA输出时是以[-256, 256]的高度区间进行归一化灰度图。如果地形的Z轴高度缩放值超过100，即地形高度范围超出-256~256米的范围，则输出高度图时需要重新归一化高度差（避免超过的部分被钳制）。相应地，在World Creator中的高度缩放值（Height Scale）需要根据以下公式重新计算\n   $$\n   \\begin{align}\n   HeightScale =& (MaxHeight-MinHeight)  / 212 \\tag{4} \\label{eq4}\n   \\end{align}\n   $$\n   \n\n### WorldCreator导入高度图\n\n<center>\n    <img src=\"WC_CustomShape.png\" width=\"45%\"> \n    <div style=\"padding: 15px;\"> WorldCreator导入高度图 </div>\n    <br>\n</center>\n1. 将地形的基础噪声强度设置为0（**GLOBAL** → **BIOMES**** → **BASE SHAPE**** → **Noise Height**）\n\n2. 根据地形尺寸设置地形精度（**GLOBAL** → **Precision**），对应HDA参数面板中的**Precision (Meter)**。\n\n   表2 WorldCreator地形精度与UE Landscape的尺寸关系\n\n   | Landscape Size | Precision   |\n   | :------------: |:----------: |\n   | 8912 x 8912    | 1 / 8 Meter |\n   | 4096 x 4096    | 1 / 4 Meter |\n   | 2048 x 2048    | 1 / 2 Meter |\n   | 1024 x 1024    | 1 Meter     |\n   | 512 x 512      | 2 Meter     |\n   | 256 x 256      | 4 Meter     |\n\n3. 将网格细分设置为10（**CUSTOM BASE SHAPE** → **Subdivision**）。\n\n4. 设置高度缩放值（**CUSTOM BASE SHAPE** → **Height Scale**），参考[表1](#高度缩放问题的解决方案)。\n\n5. 导入UE输出的高度图（**CUSTOM BASE SHAPE** → **Import**）。\n\n### WorldCreator导出高度图\n\n参数设置参考下图\n\n* 16 Bit, Single Channel\n* Auto Normalization\n* 裁剪尺寸（Export Area）\n\n<center>\n    <img src=\"WC_HeightmapOutput.png\" width=\"45%\"> \n    <div style=\"padding: 15px;\"> WorldCreator导出高度图 </div>\n    <br>\n</center>\n\n### UE更新地形\n\n<center>\n    <img src=\"ImportHeightmap_UE.png\" width=\"50%\"> \n    <div style=\"padding: 15px;\"> UE导入WorldCreator高度图 </div>\n    <br>\n</center>\n1. 在地形模式下（**Landscape → Manage → Import**），选取WorldCreator输出的高度图，点击**Import**更新地形.\n\n2. 根据HDA参数面板的**Scale Z**和**Offset Z**设置地形的高度缩放值和位移\n   * 将地形的缩放值（Transform→Scale.z）设置为**Scale Z**\n\n   * 将地形的Z轴位移（Transform→Location.z）加上**Offset Z**\n\n\n   **注意**：如果WorldCreator编辑后改变了地形的高度范围，在设置高度缩放和偏移值时不能直接使用HDA的参数。具体计算方式参考公式 \\eqref{eq2} \n\n   <center>\n       <img src=\"UpdateLandscapeTransform.png\" width=\"70%\"> \n       <div style=\"padding: 15px;\"> 设置地形的Transform </div>\n       <br>\n   </center>\n\n## 测试结果\n\n<center>\n    <img src=\"LandscapeUpdated1.png\" width=\"80%\"> \n    <div style=\"padding: 15px;\"> 地形测试（1017x1017） </div>\n    <br>\n</center>\n<center>\n    <img src=\"LandscapeUpdated2.png\" width=\"70%\"> \n    <div style=\"padding: 15px;\"> 地形测试（1891x1261） </div>\n    <br>\n</center>\n\n\n\n**相关的软件/插件版本**： \n\n* UE - 5.1\n* HoudiniEngine - H19.5.432 - Version 2.0\n* World Creator 2022.2\n\n## 参考\n\n1. [World Creator Tutorials](https://www.world-creator.com/tutorials.html)\n2. [World Creator Features](https://www.world-creator.com/features.html)\n3. [地形技术指南](https://docs.unrealengine.com/5.1/zh-CN/landscape-technical-guide-in-unreal-engine/)\n","tags":["UE","Landscape","World Creator"]},{"title":"Test","url":"/2023/02/02/Test/","content":"\nOutput Spline\n<!--more-->\n\n```python\nimport unreal as ue\nimport os\nimport csv\nfrom math import ceil\n\ndef output_csv(divs, csvFile):\n\n    filePath = os.path.dirname(csvFile)\n    if not filePath:\n        os.makedirs(filePath)\n    cf = open(csvFile, \"w\", newline='')\n    csv_writer = csv.writer(cf)\n\n    slActors = ue.EditorLevelLibrary.get_selected_level_actors()\n    for slActor in slActors:\n        spline = slActor.get_component_by_class(ue.SplineComponent)\n        length = spline.get_spline_length()\n        numberOfPoints = ceil(length / divs)\n        for i in range(numberOfPoints+1):\n            distance = i * divs\n            if i == numberOfPoints:\n                distance = length        \n            posVector = spline.get_world_location_at_distance_along_spline(distance)\n            pos = []\n            pos.append(posVector.x/100)\n            pos.append(posVector.z/100)\n            pos.append(posVector.y/100)\n            csv_writer.writerow(pos)\n\n        csv_writer.writerow(\"|\")\n    cf.close()\n\nif __name__ == '__main__':    \n    divs = 100.0\n    csvFile = \"D:/spline1.csv\"\n    print(csvFile)\n    output_csv(divs, csvFile)\n\n```\n\n<center>\n    <img src=\"Pig.png\" width=\"45%\" border =\"1100\"> \n    <div style = \"font-size: 80%\"> UE5布2料1制1作流程 </div>\n    <br>\n</center>\n\n阿斯蒂芬 三大法师法撒旦伤大防守打法啥地方伤大防守打法sad啥地方士大夫士大夫手动发送大根深蒂固为蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤蒂芬 三大法师法撒旦伤\n\n### 墙购物\n\n#### 各位亲岗位我去过未去过为问过围墙购物券歌曲\n"},{"title":"Depth in UE Material","url":"/2023/01/31/Depth-in-UE-Material/","content":"\n\n\n## **Depth Material Expressions**\n\n### **Pixel Depth**（像素深度）\n\n当前所渲染像素的深度，即该像素与摄像机之间的距离。（>=0）\n\n### **Scene Depth**（场景深度）\n\n类似于 PixelDepth，也是返回当前渲染像素与相机的距离。但有以下几点区别：\n\n1. PixelDepth只能在当前所绘制像素处进行深度取样，而SceneDepth可以在任何位置（UV）进行深度取样。  \n2. SceneDepth只能在Translucent或Post-Process材质中使用。\n3. SceneDepth的采样会忽略透明物体。如下图所示，SceneDepth的采样绕过了人物网格体，受背景对象的影响，而PixelDepth的采样与背景无关。\n\n<center>\n    <img src=\"PixelDepthVSSceneDepth.png\" width=\"45%\"> \n    <div> PixelDepth和SceneDepth </div>\n</center>\n\n\n4. 有遮挡物时，SceneDepth返回遮挡物与相机的距离（其值小于CustomDepth，两者相减可以做为遮挡蒙版）。\n\n   <center>\n       <img src=\"SceneDepthTest.png\" width=\"50%\"> \n       <div style=\"padding: 1px;\"> SceneDepth测试 </div>\n       <br>\n   </center>\n\n\n\n\n## Depth in GBuffer\n\n### **Custom Depth**（自定义深度）\n\n用于后处理（Post Processing）材质，返回物体与相机之间的距离（cm）。通过将某些对象渲染到另一个深度缓冲区（自定义深度缓冲区）来屏蔽它们。 这增加了额外的绘制调用，但不使用更多材质。渲染相当便宜，因为只输出深度。**Custom Depth**可以做一些可视化遮挡对象的效果，如绘制对象轮廓，或仅从特定视角可见。使用该特性需要在网格体的细节面板开启**Render Custom Depth Pass**选项（默认状态下，CustomDepth的返回的是一个正无穷大的数值）\n\n<center>\n    <img src=\"EnableCustomDepth.png\" width=\"45%\"> \n    <div style=\"padding: 1px;\"> 启用CustomDepth </div>\n    <br>\n</center>\n\n**测试案例**\n\n可视化遮挡对象（将被遮挡的网格体设置为蓝色）\n\n<center>\n    <img src=\"CustomDepthTest.png\" width=\"50%\"> \n    <div style=\"padding: 1px;\"> Custom Depth测试 — 效果 </div>\n    <br>\n</center>\n\n<center>\n    <img src=\"CustomDepthGraph.png\" width=\"90%\"> \n    <div style=\"padding: 1px;\"> Custom Depth测试 — 材质 </div>\n    <br>\n</center>\n\n### **Custom Depth Stencil**（自定义深度模具）\n\n用于后处理材质，是Custom Depth的扩展。可以通过**CustomDepth Stencil Value**值在材质中区分不同的网格体对象。  \n**使用自定义Custom Depth Stencil的前置设置**   \n\n* 开启项目设置里的**Custom Depth-Stencil Pass**选项\n* 开启网格体的**Render Custom Depth Pass**选项\n* 设置网格体的**CustomDepth Stencil Value** （支持 0~255的数值）\n\n<center>\n    <img src=\"EnableDepthStencil.png\" width=\"98%\"> \n    <div style=\"padding: 1px;\"> 启用Depth Stencil </div>\n    <br>\n</center>\n\n**测试案例**\n\n通过Depth Stencil值区分不同Actor，左边小球的Depth Stencil值为10（设置为蓝色），右边为20（设置为红色）\n\n<center>\n    <img src=\"DepthStencilTest.png\" width=\"50%\"> \n    <div style=\"padding: 1px;\"> Custom Depth Stencil测试 — 效果 </div>\n    <br>\n</center>\n\n<center>\n    <img src=\"CustomDepthStencilGraph.png\" width=\"90%\"> \n    <div style=\"padding: 1px;\"> Custom Depth Stencil测试 — 材质 </div>\n    <br>\n</center>\n### **Custom Scene Depth**\n\n在SceneDepth的值是一样的\n\n## 参考\n\n[Depth Material Expressions](https://docs.unrealengine.com/5.1/en-US/depth-material-expressions-in-unreal-engine/?utm_source=editor&utm_medium=docs&utm_campaign=rich_tooltips#scenedepth)  \n[后期处理材质](https://docs.unrealengine.com/5.1/zh-CN/post-process-materials-in-unreal-engine/)    \n[Custom Depth and Custom Depth Stencil in UE4](https://superyateam.com/2019/06/17/custom-depth-and-custom-depth-stencil-in-ue4/)  \n","tags":["Unreal","Material","Shader"]},{"title":"UE5 Chaos Cloth","url":"/2023/01/17/UE5-Chaos-Cloth/","content":"\n## Chaos Cloth的制作流程\n\n<center>\n    <img src=\"ChaosClothWorkflow.png\" width=\"90%\"> \n    <div style=\"padding: 1px;\"> UE5布料制作流程 </div>\n    <br>\n</center>\n\n1. **制作布料几何体**（Rig→ FBX）\n\n   * 对于有厚度或模型比较复杂的布料几何体，通常是解算代理几何体（布料简模），再去驱动最终的布料几何体。\n\n   * 给代理几何体分配一个与目标布料不同的材质（UE布料是根据材质区分不同的对象）\n\n     <center>\n         <img src=\"ProxyGeo.png\" width=\"60%\"> \n         <div style=\"padding: 1px;\"> 布料几何体及其代理 </div>\n         <br>\n     </center>\n\n2. **UE导入fbx资产**（FBX → Skeletal Mesh + Physis Asset + Skeleton）\n\n3. **创建布料** （进入SkeletalMesh编辑器面板）\n\n   * 通过材质Section隐藏最终的布料几何体，方便选择代理几何体和观察解算效果\n\n   <center>\n       <img src=\"ProxySection.png\" width=\"90%\"> \n       <div style=\"padding: 1px;\"> 根据材质Section启用/禁用几何体 </div>\n       <br>\n   </center>\n\n   * 选择目标几何体创建布料\n\n   <center>\n       <img src=\"CreateCLoth.png\" width=\"90%\"> \n       <div style=\"padding: 1px;\"> 创建布料 </div>\n       <br>\n   </center>\n\n4. **绘制布料的相关遮罩**（Max Distance, Backstop, Backstop Radius等）\n\n5. **设置布料属性**（Stiffness,  Collision, Iteration等）\n\n   关于Lo（最小值） / Hi（最大值）的设置\n\n   <center>\n       <img src=\"AttributeMask.png\" width=\"60%\"> \n       <div style=\"padding: 1px;\"> 绘制属性遮罩控制Lo/Hi值的分布 </div>\n   <br>    \n   </center>\n\n   如果在Masks中添加了布料属性的遮罩并且启用该遮罩，则 Hi 的值才会生效。绘制值为0对应 Lo的数值，绘制值为1对应Hi的数值。否则，默认只有Lo的值生效。通常，通过Lo值已经足够表达布料的物理特性。\n\n6. **使用代理几何体驱动目标布料**\n\n   移除代理几何体的布料数据，然后在目标几何体上应用代理的布料数据\n\n   <center>\n       <img src=\"ProxyDrive.png\" width=\"90%\"> \n       <div style=\"padding: 1px;\"> 代理驱动布料几何体 </div>\n       <br>\n   </center>\n   \n   \n\n## key concepts\n\n- 当布料物体的细分较大时，需要相应地提高迭代次数。\n\n- 通过**Backstop**可以有效地修复布料与碰撞体的穿插问题。\n\n- 善用 SkeletalMesh 编辑器的可视化功能去调试或排查问题。\n\n  <center>\n      <img src=\"VisualizationOfCloth.png\" width=\"50%\"> \n      <div style=\"padding: 1px;\"> 布料的可视化选项 </div>\n      <br>\n  </center>\n\n- 对于高度运动的物体，可以适当地提高解算器的迭代次数（Iterations），子步数（subdivisions ）和碰撞体的摩擦力系数（Friction Coefficient）。\n\n- 解算器的迭代次数较低时，可能无法获得比较准确的约束（**stiffness）**和阻尼（**damping**）效果\n\n- Convergence - Until you reach convergence keep stiffness settings at max.\n\n  \n\n## 三个重要的遮罩\n\n- **最大距离（Max Distance）**：布料上的点从其动画位置移动的最远距离。\n\n- **逆止半径（Backstop Radius）**：逆止范围与最大距离（Max Distance）相交时，可防止布料上已绘制的点进入该球体区域。\n\n- **逆止距离（Backstop Distance）**：布料上的点与逆止球表面的距离。\n\n  <center>\n      <img src=\"ChaosBackstop.png\" width=\"70%\"> \n      <div style=\"padding: 1px;\"> Backstop </div>\n      <br>\n  </center>\n\n\n  在每个布料顶点的后面（沿着法线的反方向）都有一个球形的逆止范围（逆止球），布料顶点到逆止球表面的距离为**逆止距离**。当逆止球与**最大距离**的范围相交时，布料顶点在解算过程中会被阻止进入逆止球的范围。当**逆止距离**设置为0时，则布料的顶点只能沿着法线的正方向运动。合理地设置**逆止半径**和**逆止距离**，可以有效地修复布料与碰撞体的穿插问题。\n\n  <center>\n      <img src=\"BackstopTest.gif\" width=\"90%\"> \n      <div style=\"padding: 1px;\"> Backstop测试 </div>\n      <br>\n  </center>\n\n\n\n## 相关指令\n\n* **Stat ChaosCloth**：显示布料性能的相关数据\n\n<center>\n    <img src=\"ClothPerformance.png\" width=\"90%\"> \n    <div style=\"padding: 1px;\"> 布料解算的开销统计 </div>\n    <br>\n</center>\n\n* **p.ClothPhysics 0**：关闭布料模拟，布料几何体将保持在最后一帧的状态\n\n* **p.ClothPhysics 1**：激活布料\n\n\n\n## 布料配置说明\n\n<center>\n    <img src=\"ChaosClothConfig.png\" width=\"60%\"> \n    <div style=\"padding: 1px;\"> 布料配置的相关参数 </div>\n    <br>\n</center>\n\n### Mass Properties\n\n**Mass Mode**\n\n* Uniform: Every particle’s mass will be set to the value specified in the UniformMass setting.      \n\n* Total Mass: The total mass is distributed equally over all the particles.     \n\n* Density: A constant mass density is used. (Recommended)\n\n### Material Properties\n\n* **Edge Stiffness**         \n\n  The stiffness of the edge constraints only uses lower than 1 values for very stretchy materials.  Increase the iteration count for stiffer materials.\n\n* **Bending Stiffness**      \n\n  The stiffness of the bending constraints.  Increase the iteration count for stiffer materials   \n\n* **Use Bending Elements**  \n\n  Enable for more accurate bending element constraints instead of the faster cross-edge spring constraints used for controlling bending stiffness. Enabling will allow access to the Buckling Ratio/Stiffness parameters.\n\n* **Buckling**\n\n  This is a feature of the Bending Element constraint (and needs the UseBendingElements ticked in the config to be enabled). It allows the Bending Element constraint to weaken or strengthen for a better control of the cloth material’s creases depending on its two parameters: Buckling Ratio and Buckling Stiffness.\n\n* **Buckling Ratio**\n\n  Once the element has bent such that it's folded more than this ratio from its rest angle (\"buckled\"), it switches to using the Buckling Stiffness instead of the Bending Stiffness. When Buckling Ratio = 0, the Buckling Stiffness will never be used. When BucklingRatio = 1, the Buckling Stiffness will be used as soon as it is bent past its rest configuration.\n\n* **Buckling Stiffness**\n\n  Bending will use this stiffness instead of Bending Stiffness once the cloth has buckled, i.e., bent beyond a certain angle. Typically, Buckling Stiffness is set to be less than Bending Stiffness. Buckling Ratio determines the switch point between using Bending Stiffness and Buckling Stiffness.\n\n* **Area Stiffness**         \n\n  The stiffness of the area preservation constraints.  Increase the iteration count for stiffer materials.\n\n### Long Range Attachment\n\n* **Tether Stiffness**        \n\n  The tether stiffness of the long-range attachment constraints.  The long-range attachment connects each of the cloth particles to its closest fixed point with a spring constraint.  This can be used to compensate for a lack of stretch resistance when the iterations count is kept low for performance reasons.  Can lead to an unnatural, pull-string puppet-like behavior.  Use 0 to disable.\n\n* **Tether Scale**            \n\n  The limit scale of the long-range attachment constraints (aka tether limit).     \n\n* **Use Geodesic Distance**  \n\n  Use geodesic instead of euclidean distance calculations for the Long Range Attachment constraint, which is slower at setup but more accurate at establishing the correct position and length of the tethers, and therefore is less prone to artifacts during the simulation.\n\n### Collision Properties\n\n* **Collision Thickness**      \n\n  The radius of cloth points when considering collisions against collider shapes.   \n\n* **Friction Coefficient**       \n\n  Friction coefficient for cloth - collider interaction.\n\n* **Use CCD**               \n\n  Use continuous collision detection (CCD) to prevent any missed collisions between fast moving particles and colliders.  This has a negative effect on performance compared to when resolving collisions without using CCD.                           \n\n* **Use Self Collisions**\n\n  Toggle to activate Self Collision Thickness, Friction and Self Intersections (below)\n\n* **Self Collision Thickness**  \n\n  The radius of the spheres used in self collision.  \n\n* **Self Collision Friction**\n\n  Friction coefficient for cloth - cloth interaction.\n\n* **Use Self Intersections**\n\n  Enable the self intersection resolution. This will try to fix any cloth intersections that are not handled by collision repulsions.\n\n* **Use Legacy Backstop** (Not recommended)    \n\n  Retained in case prior setups use it - The main difference is the backstop distance is calculated to the center of the backstop radius. New Backstop is calculated to edge of backstop sphere.                        \n\n### Environmental Properties\n\n* **Damping Coefficient**    \n\n  The amount of damping applied to the cloth velocities.  This Damping Coefficient works differently, as it is global and not at spring level.  It reduces the particles' velocities depending on the group motion. It's similar in a way to drag in a uniform non-moving fluid: the higher the coefficient, the more viscous the fluid.\n\n* **Local Damping Coefficient**  \n\n  The amount of damping for individual deviations of particle velocities from the global motion.  It's more expensive than Damping Coefficient, but also provides better results. It's called Local because it acts in relation to the cloth's center of mass, allowing damp instabilities without causing the cloth to slow down as if it was underwater. Set it to 0 to disable it.\n\n* **Use Point-Based Wind Model**   \n\n  Toggle on for legacy NvCloth setups.\n\n* **Drag**                    \n\n  The drag coefficient applying on each triangle.     \n\n* **Lift**                     \n\n  Applied on each triangle perpendicular to airspeed.  Mass has an effect with wind.\n\n* **Gravity Scale**            \n\n  Scale factor applied to the world gravity and also to the clothing simulation. interactor gravity.  Does not affect the gravity if set using the override below.                         \n\n* **Gravity**                 \n\n  The gravitational acceleration vector [cm/s^2].\n\n* **Pressure** \n\n  Adds a constant pressure force to each triangle of a simulated cloth. The effect can be modulated across the mesh via the Pressure paintable mask. The pressure force is always applied in the normal direction (use a negative value to push in the opposite direction).   \n\n### Animation Properties\n\n* **Anim Drive Stiffness**     \n\n  The strength of the constraint driving the cloth towards the animated goal mesh.   \n\n* **Anim Drive Damping**     \n\n  The damp strength of the constraint driving the cloth towards the animated goal mesh.   \n\n* **Linear Velocity Scale**     \n\n  The amount of linear velocities sent to the local cloth space from the reference bone.   \n\n* **Angular Velocity Scale**   \n\n  The amount of angular velocities sent to the local cloth space from the reference bone.   \n\n* **Fictitious Angular Scale**  \n\n  The portion of the angular velocity that is used to calculate the strength of all fictitious forces (e.g. centrifugal force). This parameter is only having an effect of the portion of the reference bone’s angular velocity that has been removed from the simulation via the Angular Velocity Scale parameter.  Values range from 0 to 2, with 0 showing no centrifugal effect, 1 full centrifugal effect and 2 an overdriven centrifugal effect.          \n\n### Simulation\n\n* **Iteration Count**（解算器的迭代次数） \n\n  提高迭代次数可以获得更精确的约束效果，但会增加CPU的开销。                       \n\n* **Max Iteration Count**（最大迭代次数）\n\n  当帧率小于60fps时，解算器的迭代次数被限制在**Max Iteration Count**的值。当帧率大于60fps时，该参数无效。  \n  With this parameter, IterationCount becomes the target number of iterations at 60fps. So, if your game currently runs at max 30fps, you will have to double the current value you are using. It will also dynamically increase internally as the framerate comes down, eg: 2 iterations set at 60fps internally becomes 4 at 30fps, 6 at 20fps, ...etc. or 1 at 120fps! MaxIterationCount is used to cap the increase in low framerates, so that you don't end up with 60 iterations at 2fps.\n\n* **Subdivision Count**（解算器的子布数）\n\n\n  可以提高碰撞和约束的精度，但会提高CPU的消耗（提升该值比增加迭代次数的消耗多50%）。对于高度运动的物体，适当增加子布数可以提高解算的稳定性。\n\n\n\n## Reference\n\n[Chaos Cloth Tool Properties Reference](https://dev.epicgames.com/community/learning/tutorials/jOrv/unreal-engine-chaos-cloth-tool-properties-reference)  \n[Cloth Troubleshooting and Debugging Tips](https://dev.epicgames.com/community/learning/tutorials/eDwk/unreal-engine-cloth-troubleshooting-and-debugging-tips)  \n[官方文档 — 布料工具](https://docs.unrealengine.com/5.1/zh-CN/clothing-tool-in-unreal-engine/)  \n"},{"title":"UE5地形生产流程","url":"/2023/01/12/UE5地形生产流程/","content":"\n具体操作可以参考文档 —— UE5 Landscape\n\n相关的软件/插件版本： \n\n* UE - 5.1\n* HoudiniEngine - H19.5.432 - Version 2.0\n* World Creator 2022.2\n\n\n\n## 地形的制作流程  \n\n<center>\n    <img src=\"CreateLandscape.png\" width=\"15%\"> \n    <div style=\"padding: 15px;\"> Landscape创建流程 </div>\n    <br>\n</center>\n\n1. **概念美术**\n\n   从美术参考中获取地形的高度信息、地形走势和区域分布\n\n   <center>\n       <img src=\"ArtRef.png\" width=\"90%\"> \n       <div style=\"padding: 1px;\"> 美术参考图 </div>\n       <br>\n   </center>\n\n2. **在World Creator中绘制地形**\n\n   * 地形尺寸参考UE官方提供的地形大小（实际制作可以大于参考值，但输出的高度图必须符合参考尺寸）\n\n   * 绘制完成后需记录地形高度的最小和最大值（用于计算UE Landscape的高度缩放和偏移值）\n\n   * 导出高度图时注意格式和尺寸\n\n   <center>\n       <img src=\"SculptInWorldCreator.png\" width=\"90%\"> \n       <div style=\"padding: 1px;\"> World Creator绘制地形 </div>\n       <br>\n   </center>\n\n3. **在UE中创建Landscape**\n\n   * 启用世界分区\n\n   * 开启地形编辑层（Enable Edit Layers）\n\n   * 根据地形尺寸合理设置世界分区的“Grid Size”（影响地形的分块数量）\n\n   * 计算高度缩放和偏移值（可以在创建地形后再设置）\n   \n   * 设置地形的组件数量和分段\n   \n   <center>\n       <img src=\"UELandscapeSetting.png\" width=\"100%\"> \n       <div style=\"padding: 2px;\"> UE导入高度图创建地形的相关设置 </div>\n       <br>\n   </center>\n\n4. **编辑基础层**\n\n   使用高度图生成地形后，根据需要细化编辑地形的基础层\n\n5. **添加地形编辑层**\n   \n   <center>\n       <img src=\"LandscapeEditLayers.png\" width=\"35%\"> \n       <div style=\"padding: 1px;\"> 地形编辑层 </div>\n       <br>\n   </center>\n   可以手动创建新的地形编辑层（一些特殊区域的绘制），或者使用HDA添加地形编辑层（创建大范围的地形结构，如水，道路等）。\n   \n   注意 HDA Actor的Transform信息需要归零。HDA的输入可以选择“**Landscape Input**”或“**World Outliner Input**”\n   \n   <center>\n       <img src=\"InputMode.png\" width=\"100%\"> \n       <div style=\"padding: 1px;\"> HDA的输入方式 </div>\n       <br>\n   </center>\n\n\n\n## 地形的更新流程\n\n<center>\n    <img src=\"UpdateLandscape.png\" width=\"75%\"> \n    <div style=\"padding: 12px;\"> Landscape更新流程 </div>\n    <br>\n</center>\n\n**地形的更新涉及基础层和其他编辑层的修改**\n\n* **修改基础层**\n  \n  涉及大结构的调整时，建议在World Creator重新编辑后更新高度图。小范围的精修可以使用UE的Sculpt雕刻。修改基础层后，对于使通过HDA创建或者更新的编辑层需要Recook相应的HDA（重新计算其他层的高度信息）\n<center>\n    <img src=\"UpdateBaseLayerAndRecookHDA.png\" width=\"80%\"> \n    <div style=\"padding: 1px;\"> 修改基础层后Recook其他编辑层的HDA </div>\n    <br>\n</center>\n\n* **修改其他编辑层**\n  \n  * 通过HDA（Recook）\n  * 使用UE Sculpt修改\n\n\n\n","tags":["地形"]},{"title":"UE5 Landscape","url":"/2023/01/12/UE5-Landscape/","content":"\n相关的软件/插件版本： \n\n* UE - 5.1\n* HoudiniEngine - H19.5.432 - Version 2.0\n* World Creator 2022.2\n\n<!--more-->\n\n## 世界分区（World Partition）\n\n[世界分区](https://docs.unrealengine.com/5.1/zh-CN/world-partition-in-unreal-engine/)是一种自动数据管理和基于距离进行加载的关卡流送系统，它针对大型世界管理提供了一套完整的解决方案。这个系统将整个世界划分为网格单元，保存在一个固定的关卡，使制作者不再需要划分繁冗的子关卡，并提供一个自动流送系统，基于与流送源之间的距离来加载和卸载这些网格。\n\n与世界分区结合使用的一些功能：\n\n- [一Actor一文件 (One Actor One File）](https://docs.unrealengine.com/5.1/zh-CN/one-file-per-actor-in-unreal-engine)）\n- [数据层（Data Layers）](https://docs.unrealengine.com/5.1/zh-CN/world-partition---data-layers-in-unreal-engine)\n- [关卡实例（Level Instancing）](https://docs.unrealengine.com/5.1/zh-CN/level-instancing-in-unreal-engine)\n- [HLOD](https://docs.unrealengine.com/5.1/zh-CN/world-partition---hierarchical-level-of-detail-in-unreal-engine)\n\n开启世界分区后，在创建地形时会根据\"**World Partition Grid Szie**\"对地形分块。区别于**Wrold Composition**的分块，**Wrold Partition**不会创建地形子关卡。\n\n<center>\n    <img src=\"LandscapeWithWP.png\" width=\"70%\"> \n    <div style=\"padding: 1px;\"> 普通地形（a）,世界分区地形（b） </div>\n    <br>\n</center>\n\n**创建世界分区地形的方法**：\n\n1. 使用开放世界（Open World）模板创建新关卡。\n\n<center>\n    <img src=\"LevelTemplate.png\" width=\"55%\"> \n    <div style=\"padding: 1px;\"> 使用开放世界关卡模板 </div>\n    <br>\n</center>\n\n2. 转化已有的关卡来使用世界分区（Tools > Convert Level）。\n\n   <center>\n       <img src=\"ToolConvertWP.png\" width=\"70%\"> \n       <div style=\"padding: 1px;\"> 将现有关卡转换为World Paritition模式 </div>\n       <br>\n   </center>\n   \n   \n\n## 创建地形\n\n### 标准化地形大小\n\n为了在最大化面积的同时最小化地形组件的数量，官方建议的地形大小如下表所示：      \n\n| 整体大小（Overall Size）(顶点) | 四边形/分段（Quads/Section） | 分段 / 组件 （Sections / Component） | 组件大小（Total Size） | 组件总数（Total Components） |\n| :----------------------------- | ---------------------------- | ------------------------------------ | ---------------------- | ---------------------------- |\n| 8129x8129                      | 127                          | 4 (2x2)                              | 254x254                | 1024 (32x32)                 |\n| 4033x4033                      | 63                           | 4 (2x2)                              | 126x126                | 1024 (32x32)                 |\n| 2017x2017                      | 63                           | 4 (2x2)                              | 126x126                | 256 (16x16)                  |\n| 1009x1009                      | 63                           | 4 (2x2)                              | 126x126                | 64 (8x8)                     |\n| 1009x1009                      | 63                           | 1                                    | 63x63                  | 256 (16x16)                  |\n| 505x505                        | 63                           | 4 (2x2)                              | 126x126                | 16 (4x4)                     |\n| 505x505                        | 63                           | 1                                    | 63x63                  | 64 (8x8)                     |\n\n### 生成方式\n\n1. **UE绘制**  \n   使用UE的Landscape模式绘制一个完整的地形\n\n   <center>\n       <img src=\"UECreateLandscapeSetting.png\" width=\"60%\"> \n       <div style=\"padding: 1px;\"> UE绘制地形的初始化设置 </div>\n       <br>\n   </center>\n\n2. 加载高度图生成地形    \n\n   由第三方软件绘制地形后导出高度图（以World Creator为例）  \n   高度图格式：  \n\n   * 16位灰阶PNG文件\n\n   * 16位灰阶.RAW文件，以小端字节排序\n\n<center>\n    <img src=\"WorldCreatorInfo.png\" width=\"100%\"> \n    <div style=\"padding: 1px;\"> World Creator绘制地形（注意地形的高度范围） </div>\n    <br>\n</center>\n<center>\n    <img src=\"WorldCreatorExportSetting.png\" width=\"40%\"> \n    <div style=\"padding: 1px;\"> World Creator导出高度图 </div>\n    <br>\n</center>\n<center>\n    <img src=\"WorldCreatorToUE.png\" width=\"100%\"> \n    <div style=\"padding: 1px;\"> UE导入高度图创建地形的相关设置 </div>\n    <br>\n</center>\n\n\n\n\n### 地形分块的尺寸（World Partition Gird Size）\n\n**World Partition Gird Size** 表示每个地形分块（LandscapeStreamingProxy）的组件数量（默认值为2）。对于一个组件数量为8x8的地形，当**World Partition Gird Size**的数值为2时，地形会被划分成16（4x4）个分块。\n\n<center>\n    <img src=\"WPGridSize.png\" width=\"60%\"> \n    <div style=\"padding: 1px;\"> World Partition Grid Size (黄色线框)</div>\n    <br>\n</center>\n\n\n\n### 地形的高度缩放与偏移\n\n<center>\n    <img src=\"LandscapeTransform.png\" width=\"60%\"> \n    <div style=\"padding: 1px;\"> 地形的位移与缩放 </div>\n    <br>\n</center>\nUE在计算地形高度时，读取的数值范围在-256到255.992之间，使用的精度为16位。这个数值与地形的Z缩放值相乘得到实际的地形高度范围。如果Z缩放值是100，则最大高度大约是256米，最大深度约-256米。  \n由于高度范围总计有512个单位（-256~256），当输入的地形的高度范围（最高值-最低值）不等于512厘米时，需要通过Z轴缩放来获得正确的地形高度。高度缩放值的计算公式如下：\n$$\nScaleZ = height * 100 / 512\n$$\n以高度为309米的山为例，代入公式计算得到的缩放比例为60.351562。\n\n为了匹配地形的实际海拔（最低值可能为负值），高度缩放后的地形还需要修改Z轴的偏移值，计算公式如下：\n$$\noffsetZ = (Height/2 + MinHeight) * 100\n$$\n当地形的最低高度为-20米时，代入公式计算得到的Z轴偏移值为13450。\n\n## 更新地形高度\n\n### 地形编辑层（Landscape Edit Layers）\n\n地形编辑层可以给地形添加多个层，每个层都可以独立编辑，实现非破坏性地更新地形高度。可以通过以下两个方式开启地形编辑层：  \n\n* 创建地形时启用Enable Edit Layers  \n* 创建地形后，在细节面板开启Enable Edit Layers     \n\n<center>\n    <img src=\"EnableEditLayers.png\" width=\"45%\"> \n    <div style=\"padding: 1px;\"> 开启地形编辑层</div>\n    <br>\n</center>\n\n### 使用高度图更新地形\n\n选择目标编辑层，在Landscape → Sculpt → Layers 找到Heightmap，右键选择重新导入高度图。建议在修改地形大结构时才使用高度图更新地形。小范围的修改可以通过UE Landscape模式的Sculpt工具绘制。\n\n<center>\n    <img src=\"UpdateByHeightmap.png\" width=\"40%\"> \n    <div style=\"padding: 1px;\"> 更新高度图修改目标编辑层</div>\n    <br>\n</center>\n\n\n\n\n\n### 使用Houdini Engine更新地形\n\n根据需求设计HDA，结合HoudiniEngine插件支持的一些属性可以直接更新地形的目标编辑层。详情参考文档 —— 使用Houdini Engine更新UE5地形。\n\n<center>\n    <img src=\"UpdateCollisionLayers.gif\" width=\"90%\"> \n    <div style=\"padding: 1px;\"> 增加/更新地形编辑层 (坠毁层) </div>\n    <br>\n</center>\n<center>\n    <img src=\"UpdateRiverLayers.gif\" width=\"90%\"> \n    <div style=\"padding: 1px;\"> 增加/更新地形编辑层 (河流层) </div>\n    <br>\n</center>\n\n\n## 洞穴\n\n<center>\n    <img src=\"LandscapeCave.png\" width=\"90%\"> \n    <div style=\"padding: 1px;\"> 地形洞穴 </div>\n    <br>\n</center>\n\n在**地形模式**中可以通过绘制**Visibility**层控制地形上特定位置的可视性和碰撞。具体操作如下：\n\n1. 在地形基材质中，将**Landscape Visibility Mask**节点接入材质属性的**Opacity Mask**。  \n   （材质的混合模式不需要设置为**Masked**）\n\n   <center>\n       <img src=\"LandscapeVisibilityMask.png\" width=\"60%\"> \n       <div style=\"padding: 1px;\"> Landscape Visibility Mask </div>\n       <br>\n   </center>\n\n2. 在地形模式（Sculpt）中绘制**Visibility**遮罩\n\n   <center>\n       <img src=\"PaintVisibility.png\" width=\"40%\"> \n       <div style=\"padding: 1px;\"> 绘制地形洞遮罩 </div>\n       <br>\n   </center>\n\n**Tip**：如果洞穴的范围覆盖了一个地形块，可以给目标地形块指定一个独立的洞穴材质。如果没有指定洞穴材质，默认使用地形材质，但会将洞穴所在的地形组件的材质混合模式改为Masked，性能开销只影响当前组件。\n\n<center>\n    <img src=\"SelectHoleMaterial.png\" width=\"55%\"> \n    <div style=\"padding: 1px;\"> 指定地形洞穴材质 </div>\n    <br>\n</center>\n\n<center>\n    <img src=\"CaveShaderComplexity.png\" width=\"55%\"> \n    <div style=\"padding: 1px;\"> 材质开销 </div>\n    <br>\n</center>\n## 参考\n\n[地形技术指南](https://docs.unrealengine.com/5.1/zh-CN/landscape-technical-guide-in-unreal-engine/)\n[Houdini Engine for Unreal](https://www.sidefx.com/docs/unreal/_landscapes.html)\n"},{"title":"使用HoudiniEngine更新UE5地形","url":"/2023/01/11/使用HoudiniEngine更新UE5地形/","content":"\nHoudini Engine for Unreal 可以通过HDA在UE中更新目标地形的编辑层或者创建一个新的地形。    \n相关的软件/插件版本： \n\n* UE - 5.1\n* HoudiniEngine - H19.5.432 - Version 2.0\n\n<!--more-->\n\n## 编辑地形层 — Editable Landscape Layers\n\n### HDA输入\n\n\nHDA无法读取地形编辑层（Landscape Edit Layers），只能将结果输出到指定的地形编辑层 。可以使用Landscape inputs（地形输入）或World Outliner Inputs（世界大纲输入）将地形导入 Houdini  。\n\n* 使用World Outliner Input时，如果选择的是LandscapeStreamingProxy对象，虽然支持多选，但只有一个地块能生效。选择Landscape对象时，整个地块都能生效\n* 使用Landscape Input 时， 只能选择一个LandscapeStreamingProxy对象或Landscape对象。\n\n   <center>\n       <img src=\"InputMode.png\" width=\"90%\"> \n       <div style=\"padding: 1px;\"> HDA的输入UE地形，Landscape inputs（a）,World Outliner Inputs（b） </div>\n       <br>\n   </center>\n\nHDA 输入带有地形编辑层的地形时 ，会将最终的高度场和各个编辑层一起导入HoudiniEngine（编辑层以 \"Landscapelayer_ 层名字\"的方式命名）。在Houdini Engine中提取这些编辑层时，需先将其转成高度场（Height）。\n<center>\n    <img src=\"LandscapeToHeightfield.png\" width=\"75%\"> \n    <div style=\"padding: 1px;\"> UE Landscape → Houdini Heightfield </div>\n    <br>\n</center>\n\n\n\n### HDA输出\n\nHoudini Engine输出的高度场可以绘制到现有地形上的可编辑地形层，输出方式由下表中的属性控制。\n\n| Attribute Name                   | Owner | Type   | Description                                       |\n| :------------------------------- | ----- | ------ | ------------------------------------------------- |\n| unreal_landscape_output_mode     | any   | int    | 设置输出模式：生成新的地形 (0) 或者修改编辑层 (1) |\n| unreal_landscape_editlayer_name  | any   | string | 目标编辑层的名称                                  |\n| unreal_landscape_editlayer_after | any   | string | 该输出层应放置在目标地形的哪个层之后              |\n\n&emsp;&emsp;**unreal_landscape_output_mode**建议设置为1，只修改输入地形的目标编辑层，而非生成一个新的地形。   \n&emsp;&emsp;目标编辑图层的名称使用**unreal_landscape_editlayer_name **属性进行设置。如果目标地形编辑图层不存在，则添加一个新的编辑图层（位于顶部）。还可以通过使用**unreal_landscape_editlayer_after**属性指定一个编辑层，将输出层放置在该层之后（上方）。\n\n<center>\n    <img src=\"UpdateEditLayers.png\" width=\"100%\"> \n    <div style=\"padding: 1px;\"> 通过HDA修改UE地形的编辑层 </div>\n    <br>\n</center>\n## 遇到的问题\n\n* **HDA添加或者修改目标编辑层后导致地形高度拉伸问题**  \n从HDA导入的地形高度场是所有编辑层叠加后的结果，经过HoudiniEngine计算后，如果直接将高度场更新至目标编辑层，则相当于叠加了两个UE地形，导致地形高度被拉伸成两倍基础层的高度。  \n**解决方法**：HDA内部处理完目标编辑层后，需要将当前高度场减去基础层，再输出给UE的目标编辑层。\n\n<center>\n    <img src=\"HeightDeform.png\" width=\"95%\"> \n    <div style=\"padding: 1px;\"> 解决高度拉伸的问题 </div>\n    <br>\n</center>\n\n* **修改地形基础层后导致其他编辑层的高度不正确的问题**   \n\n  修改地形基础层后，如果其他编辑层是通过HDA创建或修改的，会导致该层的高度叠加了基础层的修改。\n  **解决方法**：HDA输入UE地形后，先清除目标编辑层的高度信息，再进行后续的高度计算。\n\n  <center>\n      <img src=\"UpdateBaseLayerAndRecookHDA.png\" width=\"80%\"> \n      <div style=\"padding: 1px;\"> 修改基础层导致其他层高度不正确的问题 </div>\n      <br>\n  </center>\n\n* **HDA输出的地形边缘丢失高度信息**     \n\n  当HDA Actor的位移或者旋转数据不为零时，会导致输出的地形在Transform偏移的范围内丢失高度信息。\n\n  **解决方法**：关卡中与地形编辑相关的HDA Actor的Transform数值需要归零。\n\n  <center>\n      <img src=\"ResetTransform.png\" width=\"95%\"> \n      <div style=\"padding: 1px;\"> HDA Actor的Transform导致地形更新错误 </div>\n      <br>\n  </center>\n\n## 导致UE崩溃的操作\n\n* **在关卡中使用HDA读取geo缓存生成地形**\n\n  * 地形分块或未分块均会崩溃\n\n  * UE5.0不会\n\n* **没有指定地形的编辑层，直接修改输入的地形**\n\n* **unreal_landscape_output_mode 属性如果设置为0（默认1），HDA Cook后会生成新的地形导致UE崩溃**  \n\n  这些问题应该是UE5.1版本的Bug，经测试UE5.0是能正常使用的。崩溃的原因都是直接修改或创建新的Landscape导致。\n\n"},{"title":"法线贴图的烘培设置","url":"/2023/01/05/法线贴图的烘培设置/","content":"\n<!--more-->\n\n## 效果预览\n\n\n\n![效果预览](Preview.png)\n\n![法线贴图](NormalMap.png)\n\n## Houdini\n\n使用“Labs Maps Baker”节点烘培法线\n\n- “Labs Maps Baker”第一个端口连接低模，第二个端口连接高模\n- 封套（蓝色线框）应略大于低模\n- 使用Normal节点计算模型法线，Cusp Angle设置为180（软边）。\n\n![Houdini法线烘培设置](HoudniNormalBakeSetting.png)\n\n## Maya\n\nRender模块 → Lighting / Shading → Transfer Map\n\n（封套：粉色线框）\n\n![Maya法线烘培设置](MayaNormalBakeSetting.png)\n\n![Maya封套](MayaEnvelope.png)\n","tags":["法线"]}]